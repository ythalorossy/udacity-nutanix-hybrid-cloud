{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"2-tier Web Application","resources":{"client_attrs":{"8d7a5c0b_deployment":{"y":240.7898640731,"x":264.3540460742}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"445785e9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"86a105c6_runbook","main_task_local_reference":{"kind":"app_task","name":"445785e9_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"fb828d74_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"aa113063_runbook","main_task_local_reference":{"kind":"app_task","name":"fb828d74_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"ff47f0bd_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"fa66a9e2_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"ac60fe4f_runbook","main_task_local_reference":{"kind":"app_task","name":"ff47f0bd_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Stop"}],"name":"a11b8543_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"98fef3d7_runbook","main_task_local_reference":{"kind":"app_task","name":"a11b8543_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Restart"}],"name":"f214dae0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"fa66a9e2_runbook","main_task_local_reference":{"kind":"app_task","name":"f214dae0_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"WebServerAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"boot_config":true,"disk_list":{"0":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true}}}}}},"os_type":"Linux","create_spec":{"name":"vm-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"bd51e5eb-3347-4b24-858f-4c084c9f9244"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{superuser.username}@@\n    ssh-authorized-keys:\n      - @@{superuser.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"80527ac5-dcc2-4df6-a934-f2484808e419","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"18482a13-77e6-bcb7-314f-3b0d89d329d6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"7AgoUnKrK3LV148S1uHiSWj7+vdCXC+dU6wZWxoPg9nE+bVZyfRMa8GoPX3UkydXHAQX0gov0A5pVVAa7QLTP3fwgLEBvPJ\/iLtrLnbHdUdAXCNY2UOLN50TuoN0XE5MGbytQV50wnwFhNzllmA9wbCoyJm\/BjrrKjXouC8BZgmnp6Y+V6kma7xRu0+roq2hfhgrYKYF6fapyrIX69pUyq1V2EkfL1gVxsoBPJBdvkcV2A+zKIHy7wnAnjWLHPzdP8cVvb3CffrQS0IbB5Yn8nx9PEsvsFiyl9H2EATXZcUdWgK3xQ9ijo0qRwWZ0HWU0+M6q7vTdQgfa72nKmLco76BXQGG16hNVZlKFuwEUAEKV8Hc\/5J4tTZfjh471idz72qD72z9K0I7H26TEYWrr+AVqUzs5ojj2\/cfr4g8JjDhggGPVhEb4s5hrufQ9LCD0MQt7w0aignSTN+OR9Kez323LrwIQl7Jm8NWhudkun3K9XRrML10mnhqaqdsYMedouICSJuo90durxevtmI2qP4GfjAzkATcjNCDSKdcsTYLmhBZ8o58I0DJWr4Qhheh9LlI8EDr+moF5kxyQtv0d1yBENxzL6Kfve\/6yc531X\/\/2\/Snnj17h2UrPD0H6BbkIIXoU\/0HRQbjrVAmkYKIjPQrHwcaYUWwHYK1lCp\/ylUzBb0CGDTpru8+owm\/2JdKoFTqDMTR0Lojbc1nzJ56o9AkMLQwaanlHrwSiuCAi75CGkeAr4Vb0VWxdZJNmQpGYaKSltzIU\/CJWB8ugl7Fwa\/KnX2rKTgt4l\/EfCRUor5b9VKh6fwy4fiA8RB5c+7DwiRIfxeQmIEgtl8KG5cYngwrVG21p3wMzX9PD396KHJK4MYzmNbCjcUw2Gy7SV4ORoN85nrW\/gzmJEB4N1grLGvObQQSRZrb7S4FhXWWR7GiEdUJofWNvXgtmCA8wPeBX+cRF3CeXJHSEzo3pyyM3Cd3g+35nWdDBjS0BrcQgiMIb8WFW8pSdAisqvmRWzQTe1LvTy8pxNBJVFC\/gbHd4ztSvkt0AtxclIPhSO5GnAR8oO55gu47Wym2Goy+lETnJywALhcZa3Wy+TPJ\/SSucjTqhkuVrnGbTv9raGenOOLI0\/KYNp+krluENGuBjW4TzbidwWcR\/1d7piCzk4BMeWy9pQzsHseiB5EHCwrQduQzBeTtfSsk\/RPgr76LJnRSy3Mi67kZFrvT7WJNyBYDPluM1l\/lUoTUc4QyMpQfqNjRAdSVgwWflAv1kdH\/5dbyzHcbJB\/WyfH7AW2pK456jl+HvwqAKa0AvtCMn4FTuQcSrNotGDXMAyJ8H1dL+dEeHwz8Qwx5go1fkUMP9koaHYzoleqnJXRRZ037Q7mGlHFovuxb28Dz8JpPFnibPlAVw0B+tjwMXsBv2k8JhSdqbY7RFg7aTSb8I0EPsOhSapZeNuaKd5FyJwxxWO4fhLjOyzSKJLCMupKhxmnDG6chQI7kHg5ab391UZ9OB3UYiTTOU+oIcvK\/UOkH0kF1bVDEftJR1saUNT+VYxRkgv3jkdYdP2bymoAIS7R6uNpiHXJmFCjJd4aAEsahZJwkqHYyCSJT6JdMKv28\/ftV1Huu9mFbq+k7fN5WzgUanjPkgI5WPyRtBACMuw68t9bsATF\/pIS6974oxtboqpWvgH4WWRpBHhIfqToEQdiMpKdY+HcJnoOOzfuJJFgIrKdJYjmnlbPohG0lzEy\/+4qlNmEAs4Kv7VcEUoZE2PkpBbWbixbDRhB5RgBonORBTUPR6bqu6jwmPAeXaY89imvlRc08v8MudKbjdGqIOw49EvEtPcEXhY+TR3R2gVD+5EvQMJ393n8AWvPVr3ed\/UleK8o5viqnsc8lHKvbCzoDJeNDC51mpCtI1m+FbfdmSWxj6oinUPqfHuD5t5jxqJnA3o7diKb8ictSk250M9zAG1mtOGR6Iu1L\/hh2FwnL5Ia76XJ1jsKryxOujT9XXF5KKx1eE6AmXrYi9rztqQ0GSDG+dSb1SRfeUfoiqMB5N+NhUnI2rX7IXXvYsCSOzSDQqAjdimf0K284BLorssVNeDCs9eFj47aXlyAsAVRMNTyip9w5iCGXQldWejY0xiGv+TERCf\/F++ZqKGCR+vv1plmjdndp9YHjJcVJslZf1\/nrJED22zMuvpXkHI2NNIibpJK8vvXZq9mzZ4INp9stVpBmthiWxsjvUijkkoD9zTTQSPaNVjpCvrJdkjYC0IQcBz5dLQi8NL6cEpOpgZczERZmQ3KujUTH+C+1TN0VzGqO0C1V7HeofotFbMD\/y0ae3\/3vNuI4VpQAW1m0LKCu4JZS6hf+SBPBkOHKgtZSyteW9VdLHumdn5MTFrzhs1zA2Mshxj2eLoSblv4mq3nTpqg3SSohQZHm5wiYM\/ZoAFmtsy9rCjnGhkWeJgNNEhqcUTln0g5RxJ0kjr+ElTArFIef3VxBYR\/Cxcr5CnYFx0v5F6vmm5KOrgbIuR4Y4i0nbsw0OsoF4t4zZxKaXi6z5EeG6Y0J8UPjIMwB017HK+0G+I80rKL8dNIwnuB8LESGU3tw4RJz+0YfpMcjJejN01Ksu3YBLpRBsAnn0iFiMsPsSTZKMIzwBsOyCisWfLQvVmMKYLh9XM8p5csekPcERbtfJedfG1OuTa6dmj+mB1ipT\/cEcTfSye9MbrAK1boQX3f4eV36S88XUrwXenCeOVbSAG5S8j8HRL2NAn14B71TqqkrcxMDJF47mwliwoFPaE2P3IX\/ylwHJAjkJagrZg1FWxTY5\/c35jUET2z08QM7+3jz\/s76tYrmzgfUEya31b5TVShGfZhe7n6BvaCeBpoLmR18Kr4U6m5HvHmsjxTejzFMnLxiZU89cyv4FY3J6jB1IKc+n\/Nvy+ZUmiBKsl94+\/BcWZzNDExjK0DQ2RBVFWjMEAaXOH0LwJDRTT740F4sTcqA3HdsjexDyH+zAF2Fdu42Mm0WM+Jsw1MsQ4l5uwdt5ybMtXUAjPsxOVVtfEnAVBw6Sb3ICKD\/\/BjnJfiGGnLKR156xdQRIb84ooABAfZO4lW3Om5D51O6xKJvQedG6FAUB9TJ4i151J3nLcq6Wsioyw6whjNwulf+vTWjyEVrbjXBeBAJcWJRLsn7bK1LHEQ5M9BniHK9C\/F262QH0Q2nyxUE+XVMPLerUAdEo0jG8Uxj6dXqOmXjdpH+2Tk7x6lho1QxUxCPBg9cZ84TAz+p6Xfn8+PxPgmOzsoELpglgF\/cUSWEuG+nxm6dkJu9sugaP+0v6t\/a1WkH2Qc6oFddWorebmtO:utf-8"},"name":"superuser"}],"package_definition_list":[{"description":"CentOS 8 Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"Package2","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"Install_WebServer"},{"kind":"app_task","name":"2Tier_Webapp"}],"name":"a0484eda_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install_WebServer"}},{"from_task_reference":{"kind":"app_task","name":"Install_WebServer"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2Tier_Webapp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n\r\n# temporarily disable SELinux to prevent httpd to MySQL authentication issues\r\n# this is for testing only and should not be done in production environments\r\necho \"__ Temporarily disable SELinux...\"\r\nsudo setenforce 0\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2Tier_Webapp","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo touch \/var\/www\/html\/index.php\r\nsudo chown @@{superuser.username}@@:@@{superuser.username}@@ \/var\/www\/html\/index.php\r\n\r\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\r\n<html>\r\n<head>\r\n  <title>@@{calm_blueprint_name}@@<\/title>\r\n<\/head>\r\n<body>\r\n <h1>Hostname: @@{name}@@ at @@{address}@@, replica: @@{calm_array_index}@@<\/h1>\r\n<?php\r\n\r\ntry {\r\n  echo \"<h3>Web docroot: {$_SERVER[\"DOCUMENT_ROOT\"]}, file: {$_SERVER[\"SCRIPT_NAME\"]}<\/h3>\\n\";\r\n}\r\n\r\ncatch (PDOException $e) {\r\n  print \"Error!: \" . $e->getMessage() . \"<br\/>\";\r\n  print phpinfo();\r\n  die();\r\n}\r\n?><\/body>\r\n<\/html>\r\nEOF\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4a161ce1_runbook","main_task_local_reference":{"kind":"app_task","name":"a0484eda_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"9ab78648_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"e96f5315_runbook","main_task_local_reference":{"kind":"app_task","name":"9ab78648_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"8d7a5c0b_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"Package2"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServerAHV"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"USER_INITIALS","value":"yrsl","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"superuser"},"type":"USER"},"name":"WebApplication"},"api_version":"3.0","metadata":{"last_update_time":"1604435885600487","kind":"blueprint","spec_version":4,"creation_time":"1604433810339424","name":"WebApplication"}}